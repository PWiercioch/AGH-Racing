# Potentiometers-data-analysis

Numerical simulations never give exact solution, the outcome is always just an approximation. The approximation can be very accurate but also completely wrong. When designing aerodynamic package of a race car engineers want to be sure that the calculations they have made are accurate.

The main factor engineers are interested in is generated downforce - it is a force perpendicular to a road that pushes car to the ground. Downforce generated by air flowing over a car helps it drive through corners faster by increasing traction beetwen tires and the road. If downforce measured on a race track is similar to one calculated using CFD engineers can be sure they have done a good job.

Generalizing a damper can be represented as a spring. A force acting on a spring is given by formula: spring displacement times spring constant. Using linear potentiometers we logged potentiometers lengths. Knowing the spring constant as well as motion ratio(similar to gear ratio only made by suspension rods instead of gears) we can calculate force acting on a car. Except for direct load forces acting on a car are:
- aerodynamic downforce
- inertial forces
A full suspension system (in our case) consists of 4 dampers: 2 in the front and 2 in the back. One of each is a heave damper and the other is roll damper. Heave damper is activated by vertical displacement e.g. during breaking when car is leaning forward. Roll damper is activated by a horizontal displacement (rotation) e.g. when car is leaning outwards during cornering. Potentiometers output voltage which can be easily converted to damper length. The more damper is compressed (shorter) the more force is acting on it.
Detailed explanation on how a suspension system similar to one used in our car can be found [here](https://www.youtube.com/watch?v=8js55jE2da0).

Format of data logged changed continuously throughout the season and scripts used for analysis had to change as well. In this study four scripts were used.

## Table of contents
- [Initial analysis](#initial-analysis)
- [Track data analysis](#track-data-analysis)
- [Numerical simulations validation](#numerical-simulations-validation)

## Initial analysis
Firstly we had to somehow mount the potentiometers to dampers. 3D printed mountings of different shape were used. Script ***Compare_test_data.m*** was used to compare data collected for 2 different potentiometers mountings. Test data was collected in the workshop by pressing on a car in different places.

<p align="center">
  <img src="https://user-images.githubusercontent.com/83305684/120556711-2c29a100-c3fd-11eb-964f-86c1e37492b3.png" width="600"/>
</p>
<p align="center">
  <em>Potentiometers mountings comparisson</em>
</p>

It can be seen that the initial values for potentiometer lengths have changed. Also there is no hysteresis error the *Test 1* (potentiometers return to their initial position).

## Track data analysis
The script ***Calculate_forces.m*** was used to analyse data collected during track tests. 

First raw collected data is plotted.
<p align="center">
  <img src="https://user-images.githubusercontent.com/83305684/120557911-ed94e600-c3fe-11eb-91bc-cfb5386072f9.png" width="600"/>
</p>
<p align="center">
  <em>Raw data</em>
</p>

Next from logged potentiometers lengths relative displacement is calculated - first entry is treated as a reference value (assumption that data was started being recorded while the car was staionary). From relative displacement velocity can be calculated also. From data errors (weird peaks) are filtered out by replacing velocity higher than threshold by a previous correct value.

<p align="center">
  <img src="https://user-images.githubusercontent.com/83305684/120558107-42386100-c3ff-11eb-88da-3a57472eb2e6.png" width="600"/>
</p>
<p align="center">
  <em>Potentiometers relative displacement</em>
</p>

<p align="center">
  <img src="https://user-images.githubusercontent.com/83305684/120558442-c1c63000-c3ff-11eb-96e4-936a7e89bbc8.png" width="600"/>
</p>
<p align="center">
  <em>Potentiometers velocity</em>
</p>

Finally using displacement and velocity data forces acting on tires can be calculated. 

RPM is plotted alongside to give a feeling of what currently was happening to the car. We can forces change with RPM change. When RPM changes so does cars velocity and when velocity changes inertial and aerodynamic forces act on a car hence the change in plotted forces.

When car slightly rotates to the outer side during a corner a mass transfer occurs - more weight of the car is put on one side. With our collected data we couldnt specify whether car is rotating to the left or to the right but we could calculate the ratio between loads on tires for each side. Data is plotted for ***heavy loaded tire*** and ***light loaded tire***. 

<p align="center">
  <img src="https://user-images.githubusercontent.com/83305684/120559275-0e5e3b00-c401-11eb-8735-463228ae260f.png" width="600"/>
</p>
<p align="center">
  <em>Forces acting on tires</em>
</p>
On above plot we can see a ratio in loads on tires on opposite sides indicating that car is cornering.

## Numerical simulations validation
One way to measure downforce acting on a car is to drive at constant speed on a straight line so no acceleration is acting upon a car:
- no longitudinal acceleration - constant speed
- no lateral acceleration - no turning radius

Few samples of driving with different speeds on a straight line were collected.
<p align="center">
  <img src="https://user-images.githubusercontent.com/83305684/120559912-297d7a80-c402-11eb-8620-80143982010e.png" width="600"/>
</p>
<p align="center">
  <em>Collected data</em>
</p>

The plots show that the data was started collecting during a corner:
- roll dampers are decompressing - lateral acceleration is lowering
- heave dampers are compressing - the car is speeding up

For each sample data was collected for few seconds - as long as the track length allowed it. Some data is of better quality than other. During tests we had plenty of technical problems with the car but we were able to capture some good quality data.

<p align="center">
  <img src="https://user-images.githubusercontent.com/83305684/120560631-54b49980-c403-11eb-93d3-78c078d3c9ab.png" width="600"/>
</p>
<p align="center">
  <em>Good quality data</em>
</p>
On above data we can see that the values osciallte over some mean value.

The car is of electric power train meaning there is no gearbox included. This allows to calculate velocity straight from RPM data. 

By analysing each sample on its own data points for approximation were selected. Knowing that the downforce is a function of velocity squared 2nd degree polynomial was selected for approximation.

<p align="center">
  <img src="https://user-images.githubusercontent.com/83305684/120561647-35b70700-c405-11eb-9654-d88896fa3c65.png" width="400"/>
  <img src="https://user-images.githubusercontent.com/83305684/120561690-48314080-c405-11eb-95d0-c3cb56691ef3.png" width="400"/>
</p>
<p align="center">
  <em>Approximation for all data points</em>
</p>

Now some problems with collected data can be seen. For front axis approximated functions looks good but for rear axis it is nowhere close to expected. Damper compression should rise with higher velocity while in this example it is decreasing. 

The error results from inaccuracy in manufactured rear suspension system. 

In next attempt only 5 points were used. 

<p align="center">
  <img src="https://user-images.githubusercontent.com/83305684/120562465-bcb8af00-c406-11eb-8be4-0028fffd9e4d.png" width="600"/>
</p>
<p align="center">
  <em>Data points selected</em>
</p>

<p align="center">
  <img src="https://user-images.githubusercontent.com/83305684/120562605-043f3b00-c407-11eb-91dd-a3965134c8fb.png" width="400"/>
  <img src="https://user-images.githubusercontent.com/83305684/120562645-17520b00-c407-11eb-970f-c79b29b7ca63.png" width="400"/>
</p>
<p align="center">
  <em>Approximation for selected data points</em>
</p>

Values for both the front and rear axes were added together and the function was extrapolated.

<p align="center">
  <img src="https://user-images.githubusercontent.com/83305684/120562772-6009c400-c407-11eb-9440-5d77f6cbb06b.png" width="600"/>
</p>
<p align="center">
  <em>Extrapolation</em>
</p>

The lowest value of the parable should be at velocity 0 km/h. As can be seen in above plot it isn't so in this particular case. Extrapolated function tells us that for lower speeds the car produces lift instead of downforce which are not physical results. This extrapolation can be assumed as wrong and not applicable. Final calculations will be carried out for velocity in range of captured data.

Because of technical problems we do not have reference measurements for stationary vehicle. We also cannot correctly extrapolate values to 0 velocity. Because of that we are left without reference dampers lengths for stationary vehicle which makes it impossible to calculate actual velocity value acting on a car.

What we did however was to calculate the difference in damper lengths for 25 km/h (74.78 cm) and 45 km/h (71.15 cm). From this value (3.63 cm) we could calculate the downforce difference between 2 velocities: ***235.22 N***. The difference of downforce between two velocities calculated from CFD simulations is equal ***226.5 N***.

The relative error between two values is equal only 3,84% which allows to assume that the numerical simulations are validated. Considering many siplifications and technical problems it is desired to conduct such experiment once more to confirm the results.
